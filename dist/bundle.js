(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}var n,r;return n=t,r=[{key:"submitData",value:function(e,t,n){var r={method:e,headers:{"Content-Type":"application/json",Accept:"application/json"},body:t?JSON.stringify(t):null};return fetch("".concat((console.log("fetcher","development"),"http://localhost:3000/")).concat(n),r).then((function(e){return e.ok?e.json():e.json().then((function(e){throw new Error(e.name[0])}))})).then((function(e){return e})).catch((function(e){!function(e){var t=document.getElementById("errors");t.innerHTML=e,setTimeout((function(){t.innerHTML=""}),2e3)}(e)}))}}],null&&e(n.prototype,null),r&&e(n,r),t}();function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function r(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function e(o){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"CARDS",["strawberry","apple","cherry","coffee","avocado","watermelon","kiwi","applejuice","bubbletea","donut","chocolatemilk","matchatea","strawberrymilk","popsie"]),i(this,"INITIAL_TIMER",5e3),i(this,"FLIP_TIMER",500),i(this,"MOVES_LIMIT",2*this.CARDS.length),i(this,"MATCHES_TO_WIN",this.CARDS.length),i(this,"initGame",(function(){a.matchesCounter=0,a.currentScore=0,a.clickedCardMemo=null,a.movesLeft=a.MOVES_LIMIT,document.getElementById("scores").classList.remove("hidden"),a.scoresButton=document.getElementById("scores_list"),a.logoutButton=document.getElementById("logout-button"),a.logoutButton.classList.remove("hidden"),a.getCardsElement().innerHTML="",a.displayCards(),a.flipCards(a.INITIAL_TIMER),a.movesMessage(),a.displayAllScoresButton(),a.refreshUserScore(),a.logout()})),i(this,"duplicateCards",(function(){return[].concat(r(a.CARDS),r(a.CARDS))})),i(this,"shuffleCards",(function(e){for(var t,n,r=e.length;r>0;)n=Math.floor(Math.random()*r),t=e[--r],e[r]=e[n],e[n]=t;return e})),i(this,"flipCards",(function(e){setTimeout((function(e){Object.values(a.getCardsElement().getElementsByClassName("card")).forEach((function(e){e.classList.add("flipped")}))}),e)})),i(this,"getWrapperElement",(function(){return document.getElementById("game")})),i(this,"getCardsElement",(function(){return a.getWrapperElement().querySelector(".cards")})),i(this,"getCardsButtons",(function(){return Object.values(a.getCardsElement().querySelectorAll("button"))})),i(this,"disableClick",(function(){a.getCardsButtons().forEach((function(e){e.setAttribute("disabled",!0)}))})),i(this,"enableClick",(function(){a.getCardsButtons().forEach((function(e,t){e.removeAttribute("disabled")}))})),i(this,"matchTracker",(function(e,t){return e===t})),i(this,"winChecker",(function(){var e,n=a.matchesCounter===a.MATCHES_TO_WIN;return n?t.submitData("POST",{data:{user_id:a.userId,score:a.currentScore.toString()}},"scores").then((function(t){e=!0,a.displayWinLoseModal(e)})):n||0!==a.movesLeft||(e=!1,a.displayWinLoseModal(e)),e})),i(this,"createCard",(function(e,t){var n=document.createElement("button");return n.classList.add("card-button"),n.setAttribute("data-id",e),n.appendChild(t),n})),i(this,"createImageTag",(function(e,t){var n=document.createElement("img");return n.src="./images/".concat(e,".").concat(t),n})),i(this,"createflipContainer",(function(){var e=document.createElement("div");return e.classList.add("flip-container","card"),e})),i(this,"createFlipperElement",(function(){var e=document.createElement("div");return e.classList.add("flipper"),e})),i(this,"createCardAngleElement",(function(e){var t=document.createElement("div");return t.classList.add(e),t})),i(this,"timeSetter",(function(e){return setTimeout((function(t){a.clickedCardMemo.closest(".flip-container").classList.add("flipped"),e.classList.add("flipped"),a.clickedCardMemo=null,a.enableClick()}),a.FLIP_TIMER)})),i(this,"movesMessage",(function(){document.getElementById("moves").innerHTML="You have ".concat(a.movesLeft," moves left to complete this round")})),i(this,"displayWinLoseModal",(function(e){var t=document.getElementById("modal"),n=(document.getElementById("play-again"),document.getElementById("yes-button")),r=document.getElementById("no-button");t.classList.add("show");var o=e?document.getElementById("win-image"):document.getElementById("lose-image");t.classList.add("show"),o.classList.add("show"),n.addEventListener("click",(function(){t.classList.remove("show"),o.classList.remove("show"),a.initGame()})),r.addEventListener("click",(function(){location.reload()}))})),i(this,"addListener",(function(e){e.addEventListener("click",(function(e){var t=e.target,n=t.closest(".flip-container");n.classList.remove("flipped"),a.clickedCardMemo?(a.currentScore+=1,a.movesLeft-=1,a.movesMessage(),a.disableClick(),a.matchTracker(t.dataset.id,a.clickedCardMemo.dataset.id)?(a.matchesCounter+=1,a.clickedCardMemo=null,a.enableClick()):a.timeSetter(n),a.winChecker()):a.clickedCardMemo=t}))})),i(this,"displayCards",(function(){var e,t=n(a.shuffleCards(a.duplicateCards()));try{for(t.s();!(e=t.n()).done;){var r=e.value,o=a.createflipContainer(),i=a.createFlipperElement(),s=a.createCardAngleElement("front"),c=a.createCardAngleElement("back"),l=a.createImageTag(r,"jpg"),u=a.createImageTag("reverse","png"),d=a.createCard(r,u);a.addListener(d),s.appendChild(l),c.appendChild(d),i.appendChild(s),i.appendChild(c),o.appendChild(i),a.getCardsElement().appendChild(o)}}catch(e){t.e(e)}finally{t.f()}})),i(this,"addListenerToExitButton",(function(e){document.getElementById("exitBtn").addEventListener("click",(function(){e.classList.remove("show")}))})),i(this,"displayAllScoresButton",(function(){var e=document.getElementById("scores-container");a.addListenerToExitButton(e),a.scoresButton.addEventListener("click",(function(){e.classList.add("show"),t.submitData("GET",null,"scores").then((function(t){t.sort((function(e,t){return e.name<t.name?-1:1}));var r=e.querySelector("ul");r.innerHTML="";var o,a=n(t);try{for(a.s();!(o=a.n()).done;){var i=o.value,s=document.createElement("li");s.innerHTML="".concat(i.name," - ").concat(i.score),r.appendChild(s)}}catch(e){a.e(e)}finally{a.f()}}))}))})),i(this,"scoreMessage",(function(e){return e?"Your best score is ".concat(e):"You don't have any scores saved."})),i(this,"refreshUserScore",(function(){var e=document.getElementById("user_best_score");t.submitData("GET",null,"users/".concat(a.userId)).then((function(t){e.innerHTML=a.scoreMessage(t.best_score)}))})),i(this,"logout",(function(){a.logoutButton.addEventListener("click",(function(){location.reload()}))})),this.userId=o,this.initGame()};function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function e(){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"scoreMessage",(function(e){return e?"Your best score is ".concat(e):"You don't have any scores saved."})),c(this,"addListener",(function(){n.registrationForm.addEventListener("submit",(function(e){e.preventDefault(),n.name=e.target.elements["user[name]"].value,t.submitData("POST",{name:n.name},"users").then((function(e){e&&n.hideLoginWrapper.classList.add("hide"),n.userNameContainer.innerHTML="Hi ".concat(e.name,"!"),n.userBestScore.innerHTML=n.scoreMessage(e.best_score),n.recordScore.innerHTML="The highest score of all players is ".concat(e.record),new s(e.id),n.registrationForm.classList.add("hidden")}))}))})),this.registrationForm=document.getElementById("registration-form"),this.userNameContainer=document.getElementById("username"),this.hideLoginWrapper=document.getElementById("login_wrapper"),this.recordScore=document.getElementById("record_score"),this.userBestScore=document.getElementById("user_best_score"),this.addListener()};document.addEventListener("DOMContentLoaded",(function(){console.log("development"),new l}))})();